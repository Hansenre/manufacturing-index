<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/head :: head('HFPI Defect Dashboard')"></head>

<body>

<div class="container">

    <div th:replace="fragments/sidebar :: sidebar"></div>

    <div class="content">

        <h1>ðŸ“Š HFPI Defect Dashboard</h1>

        <p>
            Factory:
            <strong th:text="${factory.name}"></strong>
        </p>

        <a th:href="@{/hfpi/{id}(id=${factory.id})}" class="btn-secondary">
            â¬… Back to HFPI Events
        </a>

        <br><br>

        <canvas id="defectChart" height="120"></canvas>

    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script th:inline="javascript">
    const rawData = /*[[${defectData}]]*/ [];

    const labels = [];
    const menor = [];
    const moderado = [];
    const severo = [];

    rawData.forEach(row => {
        const defect = row.defect;
        const severity = row.severity;
        const count = row.count;

        if (!labels.includes(defect)) {
            labels.push(defect);
            menor.push(0);
            moderado.push(0);
            severo.push(0);
        }

        const index = labels.indexOf(defect);

        if (severity === 'MENOR') menor[index] = count;
        if (severity === 'MODERADO') moderado[index] = count;
        if (severity === 'SEVERO') severo[index] = count;
    });

    new Chart(document.getElementById('defectChart'), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [
                { label: 'Menor', data: menor, backgroundColor: '#16a34a' },
                { label: 'Moderado', data: moderado, backgroundColor: '#facc15' },
                { label: 'Severo', data: severo, backgroundColor: '#dc2626' }
            ]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
</script>


</body>
</html>
