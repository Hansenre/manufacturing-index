<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>HFPI Dashboard Final</title>

    <link rel="stylesheet" th:href="@{/css/hfpi-defects.css}">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3"></script>
</head>

<body>

<!-- ================= HEADER ================= -->
<div class="dashboard-header">
    <h2>ðŸ“Š HFPI 2.0 â€“ Final Dashboard</h2>
    <p>Consolidado: 60% HFPI Online + 40% HFPI Factory</p>
</div>

<!-- ================= FILTROS ================= -->
<div class="filters">

    <!-- ðŸ”½ FACTORY -->
    <div class="filter-group">
        <label>Factory</label>
        <select id="factorySelect" onchange="changeFactory(this.value)">
            <option th:each="f : ${factories}"
                    th:value="${f.id}"
                    th:text="${f.name}"
                    th:selected="${f.id == factoryId}">
            </option>
        </select>
    </div>

    <!-- ðŸ”½ FY -->
    <div class="filter-group">
        <label for="fySelect">FY</label>
        <select id="fySelect">
            <option th:each="f : ${fyOptions}"
                    th:value="${f}"
                    th:text="${f}"
                    th:selected="${f == fy}">
            </option>
        </select>
    </div>

    <!-- ðŸ”½ QUARTER -->
    <div class="filter-group">
        <label for="quarterSelect">Quarter</label>
        <select id="quarterSelect">
            <option th:each="q : ${quarterOptions}"
                    th:value="${q}"
                    th:text="${q}"
                    th:selected="${q == quarter}">
            </option>
        </select>
    </div>

    <!-- ðŸ”„ REFRESH -->
    <div class="filter-group">
        <button class="btn-primary" onclick="reloadDashboard()">
            ðŸ”„ Refresh
        </button>
    </div>
</div>

<!-- ================= GRÃFICO ================= -->
<div class="chart-container" style="height: 350px; width: 80%; margin: auto;">
    <canvas id="hfpiChart"></canvas>
</div>

<!-- ================= CONTEXT ================= -->
<script th:inline="javascript">
    const factoryId = [[${factoryId}]];
</script>

<!-- ================= JS ================= -->
<script src="/js/hfpi-dashboard-final.js"></script>

<!-- ================= NAVIGATION ================= -->
<script>
function changeFactory(factoryId) {

    const fy = document.getElementById("fySelect").value;
    const quarter = document.getElementById("quarterSelect").value;

    window.location.replace(
        `/hfpi/dashboard/final/${factoryId}?fy=${fy}&quarter=${quarter}`
    );
}

function reloadDashboard() {

    const fy = document.getElementById("fySelect").value;
    const quarter = document.getElementById("quarterSelect").value;

    window.location.replace(
        `/hfpi/dashboard/final/${factoryId}?fy=${fy}&quarter=${quarter}`
    );
}
</script>

</body>
</html>
