<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>HFPI Dashboard Final</title>

    <link rel="stylesheet" th:href="@{/css/hfpi-defects.css}">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3"></script>

    <!-- PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>

<body>

    <!-- ================= HEADER ================= -->
    <div class="dashboard-header">
        <h2>ðŸ“Š HFPI 2.0 â€“ Final Dashboard</h2>
        <p>Consolidado: 60% HFPI Online + 40% HFPI Factory</p>
    </div>

    <!-- ================= FILTROS ================= -->
    <div class="filters">

        <!-- ðŸ”½ FACTORY -->
        <div class="filter-group">
            <label>Factory</label>
            <select id="factorySelect"
                    onchange="onFactoryChange()">
                <option th:each="f : ${factories}"
                        th:value="${f.id}"
                        th:text="${f.name}"
                        th:selected="${f.id == factoryId}">
                </option>
            </select>
        </div>

        <!-- ðŸ”½ FY -->
        <div class="filter-group">
            <label for="fySelect">FY</label>
            <select id="fySelect"
                    onchange="onFyChange()">
                <option th:each="f : ${fyOptions}"
                        th:value="${f}"
                        th:text="${f}"
                        th:selected="${f == fy}">
                </option>
            </select>
        </div>

        <!-- ðŸ”½ QUARTER -->
        <div class="filter-group">
            <label for="quarterSelect">Quarter</label>
            <select id="quarterSelect"
                    onchange="onQuarterChange()">
                <option th:each="q : ${quarterOptions}"
                        th:value="${q}"
                        th:text="${q}"
                        th:selected="${q == quarter}">
                </option>
            </select>
        </div>

        <!-- ðŸ”„ REFRESH -->
        <div class="filter-group">
            <button class="btn-primary" onclick="reloadDashboard()">
                ðŸ”„ Refresh
            </button>
        </div>

        <!-- ðŸ“„ PDF -->
        <div class="filter-group">
            <button class="btn btn-danger" onclick="exportPdf()">
                ðŸ“„ Export PDF
            </button>
        </div>
    </div>
	<div id="pdf-content">
    <!-- ================= TÃTULO DO GRÃFICO ================= -->
    <h2 id="chartTitle" class="chart-title">
        HFPI 2.0 â€“ Consolidated-Onlie/Factory
    </h2>

    <!-- ================= GRÃFICO ================= -->
    <div class="chart-container">
        <canvas id="hfpiChart"></canvas>
    </div>

</div>

<!-- ================= CONTEXT ================= -->
<script th:inline="javascript">
    const factoryId = [[${factoryId}]];
</script>

<!-- ================= JS PRINCIPAL ================= -->
<script src="/js/hfpi-dashboard-final.js"></script>

<!-- ================= CONTROLES ================= -->
<script>
function onFactoryChange() {
    const newFactoryId = document.getElementById("factorySelect").value;
    const fy = document.getElementById("fySelect").value;
    const quarter = document.getElementById("quarterSelect").value;

    window.location.replace(
        `/hfpi/dashboard/final/${newFactoryId}?fy=${fy}&quarter=${quarter}`
    );
}

function onFyChange() {
    reloadDashboard();
}

function onQuarterChange() {
    reloadDashboard();
}

function reloadDashboard() {
    const fy = document.getElementById("fySelect").value;
    const quarter = document.getElementById("quarterSelect").value;

    window.location.replace(
        `/hfpi/dashboard/final/${factoryId}?fy=${fy}&quarter=${quarter}`
    );
}
</script>

</body>
</html>
